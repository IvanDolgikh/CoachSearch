import{d as A,o as k,c as V,a as n,u as h,f as x,p as D,g as E,_ as L,B as H,D as R,m as Z,s as O,h as G,i as J,j as Q,k as C,l as K,n as q,t as I,q as W,v as m,x as v,y as g,b as N,w as T,T as U,z as X,A as P,C as Y}from"./index-j9Yl35ly.js";import{u as S}from"./errorsStore-LVhNjYEV.js";import{s as ee,b as te}from"./api-yE4gVfV1.js";const se=r=>(D("data-v-227adf7e"),r=r(),E(),r),ie={class:"error-reg"},ae={class:"error-reg__container"},ne=se(()=>n("span",{class:"pi pi-exclamation-triangle"},null,-1)),re={key:0},le={key:1},oe=A({__name:"ErrorReg",setup(r){const e=S();return(s,t)=>(k(),V("div",ie,[n("div",ae,[ne,h(e).errorPhoneReg?(k(),V("p",re,"Пользователь с таким телефоном уже существует")):x("",!0),h(e).errorEmailReg?(k(),V("p",le,"Пользователь с таким email уже существует")):x("",!0)])]))}}),ue=L(oe,[["__scopeId","data-v-227adf7e"]]);var he={root:function(e){var s=e.props,t=e.instance;return["p-inputmask p-inputtext p-component",{"p-filled":t.filled,"p-invalid":s.invalid,"p-variant-filled":s.variant?s.variant==="filled":t.$primevue.config.inputStyle==="filled"}]}},de=H.extend({name:"inputmask",classes:he}),fe={name:"BaseInputMask",extends:O,props:{modelValue:null,slotChar:{type:String,default:"_"},mask:{type:String,default:null},autoClear:{type:Boolean,default:!0},unmask:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},invalid:{type:Boolean,default:!1},variant:{type:String,default:null}},style:de},j={name:"InputMask",extends:fe,emits:["update:modelValue","focus","blur","keydown","complete","keypress","paste"],watch:{mask:function(e,s){s!==e&&this.initMask()}},mounted:function(){this.initMask()},updated:function(){this.isValueUpdated()&&this.updateValue()},methods:{onInput:function(e){this.androidChrome?this.handleAndroidInput(e):this.handleInputChange(e),this.$emit("update:modelValue",e.target.value)},onFocus:function(e){var s=this;if(!this.readonly){this.focus=!0,clearTimeout(this.caretTimeoutId);var t;this.focusText=this.$el.value,t=this.checkVal(),this.caretTimeoutId=setTimeout(function(){s.$el===document.activeElement&&(s.writeBuffer(),t===s.mask.replace("?","").length?s.caret(0,t):s.caret(t))},10),this.$emit("focus",e)}},onBlur:function(e){if(this.focus=!1,this.checkVal(),this.updateModel(e),this.$el.value!==this.focusText){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.$el.dispatchEvent(s)}this.$emit("blur",e)},onKeyDown:function(e){if(!this.readonly){var s=e.which||e.keyCode,t,a,i,o=/iphone/i.test(R.getUserAgent());this.oldVal=this.$el.value,s===8||s===46||o&&s===127?(t=this.caret(),a=t.begin,i=t.end,i-a===0&&(a=s!==46?this.seekPrev(a):i=this.seekNext(a-1),i=s===46?this.seekNext(i):i),this.clearBuffer(a,i),this.shiftL(a,i-1),this.updateModel(e),e.preventDefault()):s===13?(this.$el.blur(),this.updateModel(e)):s===27&&(this.$el.value=this.focusText,this.caret(0,this.checkVal()),this.updateModel(e),e.preventDefault()),this.$emit("keydown",e)}},onKeyPress:function(e){var s=this;if(!this.readonly){var t=e.which||e.keyCode,a=this.caret(),i,o,c,f;if(!(e.ctrlKey||e.altKey||e.metaKey||t<32)){if(t&&t!==13){if(a.end-a.begin!==0&&(this.clearBuffer(a.begin,a.end),this.shiftL(a.begin,a.end-1)),i=this.seekNext(a.begin-1),i<this.len&&(o=String.fromCharCode(t),this.tests[i].test(o))){if(this.shiftR(i),this.buffer[i]=o,this.writeBuffer(),c=this.seekNext(i),/android/i.test(R.getUserAgent())){var b=function(){s.caret(c)};setTimeout(b,0)}else this.caret(c);a.begin<=this.lastRequiredNonMaskPos&&(f=this.isCompleted())}e.preventDefault()}this.updateModel(e),f&&this.$emit("complete",e),this.$emit("keypress",e)}}},onPaste:function(e){this.handleInputChange(e),this.$emit("paste",e)},caret:function(e,s){var t,a,i;if(!(!this.$el.offsetParent||this.$el!==document.activeElement))if(typeof e=="number")a=e,i=typeof s=="number"?s:a,this.$el.setSelectionRange?this.$el.setSelectionRange(a,i):this.$el.createTextRange&&(t=this.$el.createTextRange(),t.collapse(!0),t.moveEnd("character",i),t.moveStart("character",a),t.select());else return this.$el.setSelectionRange?(a=this.$el.selectionStart,i=this.$el.selectionEnd):document.selection&&document.selection.createRange&&(t=document.selection.createRange(),a=0-t.duplicate().moveStart("character",-1e5),i=a+t.text.length),{begin:a,end:i}},isCompleted:function(){for(var e=this.firstNonMaskPos;e<=this.lastRequiredNonMaskPos;e++)if(this.tests[e]&&this.buffer[e]===this.getPlaceholder(e))return!1;return!0},getPlaceholder:function(e){return e<this.slotChar.length?this.slotChar.charAt(e):this.slotChar.charAt(0)},seekNext:function(e){for(;++e<this.len&&!this.tests[e];);return e},seekPrev:function(e){for(;--e>=0&&!this.tests[e];);return e},shiftL:function(e,s){var t,a;if(!(e<0)){for(t=e,a=this.seekNext(s);t<this.len;t++)if(this.tests[t]){if(a<this.len&&this.tests[t].test(this.buffer[a]))this.buffer[t]=this.buffer[a],this.buffer[a]=this.getPlaceholder(a);else break;a=this.seekNext(a)}this.writeBuffer(),this.caret(Math.max(this.firstNonMaskPos,e))}},shiftR:function(e){var s,t,a,i;for(s=e,t=this.getPlaceholder(e);s<this.len;s++)if(this.tests[s])if(a=this.seekNext(s),i=this.buffer[s],this.buffer[s]=t,a<this.len&&this.tests[a].test(i))t=i;else break},handleAndroidInput:function(e){var s=this.$el.value,t=this.caret();if(this.oldVal&&this.oldVal.length&&this.oldVal.length>s.length){for(this.checkVal(!0);t.begin>0&&!this.tests[t.begin-1];)t.begin--;if(t.begin===0)for(;t.begin<this.firstNonMaskPos&&!this.tests[t.begin];)t.begin++;this.caret(t.begin,t.begin)}else{for(this.checkVal(!0);t.begin<this.len&&!this.tests[t.begin];)t.begin++;this.caret(t.begin,t.begin)}this.isCompleted()&&this.$emit("complete",e)},clearBuffer:function(e,s){var t;for(t=e;t<s&&t<this.len;t++)this.tests[t]&&(this.buffer[t]=this.getPlaceholder(t))},writeBuffer:function(){this.$el.value=this.buffer.join("")},checkVal:function(e){this.isValueChecked=!0;var s=this.$el.value,t=-1,a,i,o;for(a=0,o=0;a<this.len;a++)if(this.tests[a]){for(this.buffer[a]=this.getPlaceholder(a);o++<s.length;)if(i=s.charAt(o-1),this.tests[a].test(i)){this.buffer[a]=i,t=a;break}if(o>s.length){this.clearBuffer(a+1,this.len);break}}else this.buffer[a]===s.charAt(o)&&o++,a<this.partialPosition&&(t=a);return e?this.writeBuffer():t+1<this.partialPosition?this.autoClear||this.buffer.join("")===this.defaultBuffer?(this.$el.value&&(this.$el.value=""),this.clearBuffer(0,this.len)):this.writeBuffer():(this.writeBuffer(),this.$el.value=this.$el.value.substring(0,t+1)),this.partialPosition?a:this.firstNonMaskPos},handleInputChange:function(e){var s=e.type==="paste";if(!(this.readonly||s)){var t=this.checkVal(!0);this.caret(t),this.updateModel(e),this.isCompleted()&&this.$emit("complete",e)}},getUnmaskedValue:function(){for(var e=[],s=0;s<this.buffer.length;s++){var t=this.buffer[s];this.tests[s]&&t!==this.getPlaceholder(s)&&e.push(t)}return e.join("")},updateModel:function(e){var s=this.unmask?this.getUnmaskedValue():e.target.value;this.$emit("update:modelValue",this.defaultBuffer!==s?s:"")},updateValue:function(){var e=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.$el&&(this.modelValue==null?(this.$el.value="",s&&this.$emit("update:modelValue","")):(this.$el.value=this.modelValue,this.checkVal(),setTimeout(function(){if(e.$el&&(e.writeBuffer(),e.checkVal(),s)){var t=e.unmask?e.getUnmaskedValue():e.$el.value;e.$emit("update:modelValue",e.defaultBuffer!==t?t:"")}},10)),this.focusText=this.$el.value)},initMask:function(){this.tests=[],this.partialPosition=this.mask.length,this.len=this.mask.length,this.firstNonMaskPos=null,this.defs={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"};var e=R.getUserAgent();this.androidChrome=/chrome/i.test(e)&&/android/i.test(e);for(var s=this.mask.split(""),t=0;t<s.length;t++){var a=s[t];a==="?"?(this.len--,this.partialPosition=t):this.defs[a]?(this.tests.push(new RegExp(this.defs[a])),this.firstNonMaskPos===null&&(this.firstNonMaskPos=this.tests.length-1),t<this.partialPosition&&(this.lastRequiredNonMaskPos=this.tests.length-1)):this.tests.push(null)}this.buffer=[];for(var i=0;i<s.length;i++){var o=s[i];o!=="?"&&(this.defs[o]?this.buffer.push(this.getPlaceholder(i)):this.buffer.push(o))}this.defaultBuffer=this.buffer.join(""),this.updateValue(!1)},isValueUpdated:function(){return this.unmask?this.modelValue!=this.getUnmaskedValue():this.defaultBuffer!==this.$el.value&&this.$el.value!==this.modelValue}},computed:{filled:function(){return this.modelValue!=null&&this.modelValue.toString().length>0},ptmParams:function(){return{context:{filled:this.filled,disabled:this.$attrs.disabled||this.$attrs.disabled===""}}}}},ce=["readonly"];function pe(r,e,s,t,a,i){return k(),V("input",Z({class:r.cx("root"),readonly:r.readonly,onInput:e[0]||(e[0]=function(){return i.onInput&&i.onInput.apply(i,arguments)}),onFocus:e[1]||(e[1]=function(){return i.onFocus&&i.onFocus.apply(i,arguments)}),onBlur:e[2]||(e[2]=function(){return i.onBlur&&i.onBlur.apply(i,arguments)}),onKeydown:e[3]||(e[3]=function(){return i.onKeyDown&&i.onKeyDown.apply(i,arguments)}),onKeypress:e[4]||(e[4]=function(){return i.onKeyPress&&i.onKeyPress.apply(i,arguments)}),onPaste:e[5]||(e[5]=function(){return i.onPaste&&i.onPaste.apply(i,arguments)})},r.ptm("root",i.ptmParams)),null,16,ce)}j.render=pe;const me=G("register",()=>{const r=J(),e=Q(),s=S(),t=_=>_==="Customer"?{name:"user-profile"}:{name:"coach-profile"},a=`${te}api/auth/register`,i=C({phoneNumber:"",email:"",password:"",fullName:"",info:"",vkLink:"",telegramLink:"",avatar:null}),o=C({address:""}),c=K(!1),f=q(()=>c.value?"coach":"customer");return{commonData:i,additionalDataTrainer:o,userRole:c,checkUserRole:f,sendDataReg:async()=>{e.loading=!0;const _={phoneNumber:i.phoneNumber.replace(/-/gi,""),email:i.email,password:i.password,fullName:i.fullName,info:i.info,vkLink:i.vkLink,telegramLink:i.telegramLink,avatar:i.avatar};try{if(["customer","coach"].includes(f.value)){f.value==="coach"&&(_.address=o.address);const p=await ee(`${a}/${f.value}`,_);localStorage.setItem("accessToken",p.accessToken),localStorage.setItem("role",p.role);const y=localStorage.getItem("role")||"",B=t(y);return e.loading=!1,r.push(B),p}else throw Error}catch(p){e.loading=!1,s.showAndHideRegError(p.message)}}}}),d=r=>(D("data-v-2216b6c0"),r=r(),E(),r),ge={class:"registration"},_e={class:"registration__container"},ve={class:"registration__base-data"},ke=d(()=>n("p",{class:"registration__title"},"Личная информация",-1)),be={class:"registration__input-container"},ye=d(()=>n("span",null,[P("ФИО "),n("sup",null,"*")],-1)),Ve={class:"registration__input-container"},Pe=d(()=>n("span",null,[P("Номер телефона "),n("sup",null,"*")],-1)),we={class:"registration__input-container"},$e=d(()=>n("span",null,[P("Электронная почта "),n("sup",null,"*")],-1)),xe={class:"registration__input-textarea-container"},Be=d(()=>n("span",null,"Расскажите о себе",-1)),Re={key:0},Ne={class:"registration__input-container"},Se=d(()=>n("span",null,[P("Место проведения"),n("br"),P("тренировок "),n("sup",null,"*")],-1)),Me={class:"registration__social"},Ce={class:"registration__input-image-container"},Ie=d(()=>n("p",{class:"registration__title"},"Ваше фото",-1)),Te=["src"],Ue=d(()=>n("p",{class:"registration__title"},"Профили в соцсетях",-1)),Ae={class:"registration__input-container"},De=d(()=>n("span",null,"Вконтакте",-1)),Ee={class:"registration__input-container"},Le=d(()=>n("span",null,"Телеграмм",-1)),Ke={class:"registration__entrance-data"},qe={class:"registration__input-container"},je=d(()=>n("span",null,[P("Пароль "),n("sup",null,"*")],-1)),Fe={class:"registration__button-container"},ze={class:"registration__checkbox-container"},He=d(()=>n("span",null,"Я тренер",-1)),Ze=d(()=>n("button",{class:"registration__button"}," Зарегистрироваться ",-1)),Oe=A({__name:"TheRegistration",setup(r){const e=me(),s=S(),{phoneNumber:t,email:a,password:i,fullName:o,info:c,vkLink:f,telegramLink:b,avatar:_}=I(e.commonData),{address:p}=I(e.additionalDataTrainer),y=K(""),B=w=>{var u,M;const l=(M=(u=w.target)==null?void 0:u.files)==null?void 0:M[0];if(l){_.value=l;const $=new FileReader;$.onload=()=>{$.result&&(y.value=$.result)},$.readAsDataURL(l)}},F=w=>w instanceof ArrayBuffer,z=q(()=>F(y.value)?URL.createObjectURL(new Blob([y.value])):y.value);return(w,l)=>(k(),V("div",ge,[n("div",_e,[n("form",{class:"registration__form",method:"post",onSubmit:l[9]||(l[9]=W(u=>h(e).sendDataReg(),["prevent"]))},[n("div",ve,[ke,n("label",be,[ye,m(n("input",{type:"text",name:"FullName",required:"","onUpdate:modelValue":l[0]||(l[0]=u=>g(o)?o.value=u:null)},null,512),[[v,h(o)]])]),n("label",Ve,[Pe,N(h(j),{name:"PhoneNumber",required:"",modelValue:h(t),"onUpdate:modelValue":l[1]||(l[1]=u=>g(t)?t.value=u:null),mask:"8-999-999-99-99",placeholder:"8-999-999-99-99"},null,8,["modelValue"])]),n("label",we,[$e,m(n("input",{type:"email",name:"Email",placeholder:"user@mail.ru","onUpdate:modelValue":l[2]||(l[2]=u=>g(a)?a.value=u:null),required:""},null,512),[[v,h(a)]])]),n("label",xe,[Be,m(n("textarea",{name:"Info",id:"",cols:"30",rows:"5","onUpdate:modelValue":l[3]||(l[3]=u=>g(c)?c.value=u:null)},null,512),[[v,h(c)]])]),N(U,{name:"slide-fade"},{default:T(()=>[h(e).userRole?(k(),V("div",Re,[n("label",Ne,[Se,m(n("input",{type:"text",name:"Address",required:"","onUpdate:modelValue":l[4]||(l[4]=u=>g(p)?p.value=u:null)},null,512),[[v,h(p)]])])])):x("",!0)]),_:1})]),n("div",Me,[n("label",Ce,[Ie,n("img",{class:"registration__custom-input-image",src:z.value,alt:""},null,8,Te),n("input",{type:"file",class:"visually-hidden",name:"Avatar",onChange:B},null,32)]),Ue,n("label",Ae,[De,m(n("input",{type:"text",name:"VkLink","onUpdate:modelValue":l[5]||(l[5]=u=>g(f)?f.value=u:null)},null,512),[[v,h(f)]])]),n("label",Ee,[Le,m(n("input",{type:"text",name:"TelegramLink","onUpdate:modelValue":l[6]||(l[6]=u=>g(b)?b.value=u:null)},null,512),[[v,h(b)]])])]),n("div",Ke,[n("label",qe,[je,m(n("input",{type:"password",name:"Password",required:"","onUpdate:modelValue":l[7]||(l[7]=u=>g(i)?i.value=u:null)},null,512),[[v,h(i)]])])]),n("div",Fe,[n("label",ze,[m(n("input",{type:"checkbox","onUpdate:modelValue":l[8]||(l[8]=u=>h(e).userRole=u)},null,512),[[X,h(e).userRole]]),He]),Ze])],32),N(U,{name:"error"},{default:T(()=>[h(s).errorPhoneReg||h(s).errorEmailReg?(k(),Y(ue,{key:0,class:"registration__error"})):x("",!0)]),_:1})])]))}}),We=L(Oe,[["__scopeId","data-v-2216b6c0"]]);export{We as default};
